<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.kro.runleaf.repository.RunningDataRepository">
	<select id="selectRunningDataList" resultType="RunningData"
			parameterType="BoardSearch" >
		<choose>
			<when test="orderInt == 1">
				SELECT 	b.board_id, 
						b.member_id AS board_member_id,
						b.running_data_id,
						b.content, 
						b.created_date,
						b.modifided_date, 
						b.main_image_path,
						b.writer,
						r.start_latitude, 
						r.start_longitude,
						r.difficulty,
						r.running_time,
						r.title,	
						r.one_line_comment AS one_line_comment,
						r.created_time,
					ST_Distance_Sphere(
						POINT(r.start_longitude, r.start_latitude),
						POINT(#{longitude}, #{latitude})
						) AS distance
				FROM board b
				JOIN running_data r on b.running_data_id = r.running_data_id
				order by distance asc
				limit #{startIdx}, 5;
			</when>
			<when test="orderInt == 2">
				select board_id, 
				member_id, 
				running_data_id, 
				content, 
				created_date,
				modifided_date, 
				main_image_path, 
				now_latitude, 
				now_longitude
				from board
				order by created_date asc
				limit #{startIdx}, 5
			</when>
		</choose>
	</select>
	<insert id="insertRunningData" parameterType="RunningData" useGeneratedKeys="true" keyProperty="runningDataId">
		insert into running_data (
			member_id, 
		    difficulty, 
		    running_time, 
		    start_latitude,
		    start_longitude,
		    title,
		    one_line_comment
		    
		)
		VALUES (
			#{memberId},
		    #{difficulty},
		    #{runningTime},
		    #{startLatitude},
		    #{startLongitude},
		    #{title},
		    #{oneLineComment}
		)
	</insert>
	<insert id="insertRunningDataImage" parameterType="RunningDataImage" >
		insert into running_data_image (
			running_data_id, 
		    real_name, 
		    system_name, 
		    path
		)
		VALUES (
			#{runningDataId},
		    #{realName},
		    #{systemName},
		    #{path}
		)
	</insert>
</mapper>


